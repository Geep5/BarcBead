<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Barc - Decentralized Page Chat</title>
  <link rel="stylesheet" href="dashboard.css">
  <link rel="stylesheet" href="dashboard-chat.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <div id="app">
    <!-- Setup overlay (shown first time) -->
    <div id="setup-overlay" class="overlay hidden">
      <div class="setup-content">
        <div class="logo-large">
          <div class="logo-icon-box">b</div>
        </div>
        <h2>Welcome to Barc</h2>
        <p>Chat with others viewing the same pages</p>

        <div class="setup-options">
          <button id="generate-key-btn" class="btn primary full-width">Generate New Identity</button>
          <div class="divider"><span>or</span></div>
          <div class="input-group">
            <label for="import-key-input">Import existing key (nsec or hex)</label>
            <input type="password" id="import-key-input" placeholder="nsec1... or hex private key">
          </div>
          <button id="import-key-btn" class="btn secondary full-width">Import Key</button>
        </div>

        <p class="small">Powered by Nostr - fully decentralized</p>
      </div>
    </div>

    <!-- Main layout -->
    <div id="main-layout" class="hidden">

      <!-- Browser Header / Tab Strip -->
      <header id="browser-header">
        <!-- Logo Area -->
        <div class="header-logo">
          <div class="logo-icon-box">b</div>
        </div>

        <!-- Tabs Scroll Area -->
        <div id="tabs-strip" class="tabs-strip">
          <!-- Private tab (always present) -->
          <div class="header-tab active" data-tab-id="tab-private" data-tab-type="dm-home">
            <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
            <span class="tab-name">Private</span>
          </div>
          <!-- Dynamic tabs will be added here -->

          <!-- New Tab Button -->
          <button id="new-tab-btn" class="new-tab-btn" title="Open new tab">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
          </button>
        </div>

        <!-- Right Actions: User Menu -->
        <div class="header-user">
          <button id="user-menu-btn" class="user-menu-btn">
            <div id="header-avatar" class="header-avatar">
              <span>ME</span>
            </div>
            <svg class="chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </button>

          <!-- User Dropdown -->
          <div id="user-dropdown" class="dropdown hidden">
            <div class="dropdown-header">
              <p class="dropdown-name" id="dropdown-user-name">Anonymous</p>
              <p class="dropdown-id" id="dropdown-user-id">@user</p>
            </div>
            <div class="dropdown-divider"></div>
            <button class="dropdown-item" id="dropdown-settings">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
              </svg>
              <span>Settings</span>
            </button>
            <div class="dropdown-divider"></div>
            <button class="dropdown-item danger" id="dropdown-logout">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                <polyline points="16 17 21 12 16 7"></polyline>
                <line x1="21" y1="12" x2="9" y2="12"></line>
              </svg>
              <span>Log out</span>
            </button>
          </div>
        </div>
      </header>

      <!-- New Tab Popover -->
      <div id="new-tab-popover" class="popover hidden">
        <div class="popover-header">
          <div class="popover-search">
            <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"></circle>
              <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
            <input type="text" id="popover-search" placeholder="Search websites or tags..." autofocus>
          </div>
        </div>
        <div class="popover-content">
          <!-- Websites Section -->
          <div class="popover-section">
            <div class="popover-section-header">
              <h4>Websites</h4>
              <button class="popover-action" id="add-website-btn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="12" y1="5" x2="12" y2="19"></line>
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                Add Website
              </button>
            </div>
            <div id="popover-websites" class="popover-list">
              <!-- Website items will be rendered here -->
            </div>
          </div>

          <!-- Tags Section -->
          <div class="popover-section">
            <div class="popover-section-header">
              <h4>Top Tags</h4>
            </div>
            <div id="popover-tags" class="popover-list">
              <!-- Tag items will be rendered here -->
            </div>
          </div>

          <!-- Create new tag -->
          <button id="create-tag-btn" class="popover-create-btn">
            <div class="create-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
            </div>
            <span>Create new tag "<span id="create-tag-name">...</span>"</span>
          </button>
        </div>
      </div>

      <!-- Main Content Area -->
      <div id="content-area">
        <!-- Sidebar -->
        <aside id="sidebar">
          <!-- Sidebar Header -->
          <div class="sidebar-header">
            <h2 id="sidebar-title">
              <svg id="sidebar-icon-dm" class="sidebar-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
              </svg>
              <svg id="sidebar-icon-lobby" class="sidebar-icon hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
              </svg>
              <span id="sidebar-title-text">Private Messages</span>
            </h2>
          </div>

          <!-- Sidebar Content (scrollable) -->
          <div id="sidebar-content" class="sidebar-content">
            <!-- DM List (shown in dm-home mode) -->
            <div id="dm-list" class="sidebar-list">
              <!-- DM items will be rendered here -->
              <div class="sidebar-empty">No conversations yet</div>
            </div>

            <!-- Lobby Members (shown in server/channel mode) -->
            <div id="lobby-list" class="sidebar-list hidden">
              <div class="sidebar-subheader">
                <span>Online ‚Äî <span id="online-count">0</span></span>
              </div>
              <!-- Member items will be rendered here -->
            </div>
          </div>
        </aside>

        <!-- Resize Handle -->
        <div id="resize-handle" class="resize-handle"></div>

        <!-- Chat Area -->
        <main id="chat-area">
          <!-- Empty State -->
          <div id="no-selection" class="empty-state">
            <div class="empty-icon-box">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
              </svg>
            </div>
            <h2>Select a conversation</h2>
            <p>Choose from the sidebar or open a new tab to start chatting</p>
          </div>

          <!-- Profile view -->
          <div id="profile-container" class="hidden">
            <div class="profile-header">
              <div class="profile-info">
                <div class="profile-avatar" id="profile-avatar">
                  <span>U</span>
                </div>
                <div class="profile-details">
                  <div id="profile-name" class="profile-name">User</div>
                  <div id="profile-pubkey" class="profile-pubkey">npub1...</div>
                </div>
              </div>
              <div class="profile-actions">
                <button id="follow-btn" class="btn primary follow-btn hidden">Follow</button>
                <button id="close-profile-btn" class="btn icon close-btn" title="Close profile">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                  </svg>
                </button>
              </div>
            </div>

            <div class="profile-feed-section">
              <div class="profile-tabs">
                <button class="profile-tab active" data-tab="mentions">Mentions</button>
                <button class="profile-tab" data-tab="posts">Their Posts</button>
                <button class="profile-tab" data-tab="chats">Active Chats</button>
              </div>
              <div id="profile-feed" class="profile-feed">
                <!-- Feed items will appear here -->
              </div>
              <div id="profile-loading" class="profile-loading hidden">
                <span class="loading-spinner"></span>
                <span>Loading...</span>
              </div>
              <div id="profile-empty" class="profile-empty hidden">
                No posts found
              </div>
            </div>
          </div>

          <!-- Chat Container -->
          <div id="chat-container" class="hidden">
            <!-- Chat Header -->
            <div class="chat-header">
              <div class="chat-info">
                <div class="chat-title-row">
                  <svg class="chat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="4" y1="9" x2="20" y2="9"></line>
                    <line x1="4" y1="15" x2="20" y2="15"></line>
                    <line x1="10" y1="3" x2="8" y2="21"></line>
                    <line x1="16" y1="3" x2="14" y2="21"></line>
                  </svg>
                  <h3 id="chat-title">Channel</h3>
                </div>
              </div>
              <div class="chat-actions">
                <button id="chat-search-btn" class="header-action-btn" title="Search">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                  </svg>
                </button>
                <button id="chat-alert-btn" class="header-action-btn" title="Toggle alerts">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                    <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                  </svg>
                </button>
                <button id="pin-btn" class="header-action-btn" title="Pin channel">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                    <circle cx="12" cy="10" r="3"></circle>
                  </svg>
                </button>
                <button id="members-btn" class="header-action-btn" title="Members">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                  </svg>
                </button>
              </div>
            </div>

            <!-- Welcome Message -->
            <div id="chat-welcome" class="chat-welcome">
              <div id="welcome-icon" class="welcome-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="4" y1="9" x2="20" y2="9"></line>
                  <line x1="4" y1="15" x2="20" y2="15"></line>
                  <line x1="10" y1="3" x2="8" y2="21"></line>
                  <line x1="16" y1="3" x2="14" y2="21"></line>
                </svg>
              </div>
              <h1 id="welcome-title">Welcome to #general!</h1>
              <p id="welcome-description">This is the start of the #general channel.</p>
            </div>

            <!-- Messages -->
            <div id="messages" class="messages">
              <!-- Messages will appear here -->
            </div>

            <!-- Input Area -->
            <div class="input-area">
              <div class="input-container">
                <div class="input-toolbar-left">
                  <button id="attach-btn" class="input-action-btn" title="Add attachment">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <line x1="12" y1="5" x2="12" y2="19"></line>
                      <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                  </button>
                </div>

                <div class="input-wrapper">
                  <textarea id="message-input" placeholder="Message #general" rows="1"></textarea>
                  <!-- @mention autocomplete -->
                  <div id="mention-picker" class="mention-picker hidden">
                    <div id="mention-list" class="mention-list">
                      <!-- Matching users will appear here -->
                    </div>
                  </div>
                </div>

                <div class="input-toolbar-right">
                  <button id="emoji-btn" class="input-action-btn" title="Add emoji">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"></circle>
                      <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>
                      <line x1="9" y1="9" x2="9.01" y2="9"></line>
                      <line x1="15" y1="9" x2="15.01" y2="9"></line>
                    </svg>
                  </button>
                  <button id="send-btn" class="send-btn" title="Send message">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <line x1="22" y1="2" x2="11" y2="13"></line>
                      <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                    </svg>
                  </button>
                </div>
              </div>
              <div class="input-hint">
                <span><strong>Return</strong> to send, <strong>Shift + Return</strong> for new line</span>
              </div>
            </div>

            <!-- Emoji picker -->
            <div id="emoji-picker" class="emoji-picker hidden">
              <div class="emoji-grid">
                <span class="emoji" data-emoji="üòÄ">üòÄ</span>
                <span class="emoji" data-emoji="üòÇ">üòÇ</span>
                <span class="emoji" data-emoji="üòä">üòä</span>
                <span class="emoji" data-emoji="üòç">üòç</span>
                <span class="emoji" data-emoji="ü•∞">ü•∞</span>
                <span class="emoji" data-emoji="üòé">üòé</span>
                <span class="emoji" data-emoji="ü§î">ü§î</span>
                <span class="emoji" data-emoji="üò¢">üò¢</span>
                <span class="emoji" data-emoji="üò≠">üò≠</span>
                <span class="emoji" data-emoji="üò§">üò§</span>
                <span class="emoji" data-emoji="ü§Ø">ü§Ø</span>
                <span class="emoji" data-emoji="üò±">üò±</span>
                <span class="emoji" data-emoji="üôÑ">üôÑ</span>
                <span class="emoji" data-emoji="üòè">üòè</span>
                <span class="emoji" data-emoji="ü§ó">ü§ó</span>
                <span class="emoji" data-emoji="üëç">üëç</span>
                <span class="emoji" data-emoji="üëé">üëé</span>
                <span class="emoji" data-emoji="üëè">üëè</span>
                <span class="emoji" data-emoji="üôå">üôå</span>
                <span class="emoji" data-emoji="ü§ù">ü§ù</span>
                <span class="emoji" data-emoji="üí™">üí™</span>
                <span class="emoji" data-emoji="üéâ">üéâ</span>
                <span class="emoji" data-emoji="üî•">üî•</span>
                <span class="emoji" data-emoji="‚ù§Ô∏è">‚ù§Ô∏è</span>
                <span class="emoji" data-emoji="üíØ">üíØ</span>
                <span class="emoji" data-emoji="‚úÖ">‚úÖ</span>
                <span class="emoji" data-emoji="‚ùå">‚ùå</span>
                <span class="emoji" data-emoji="‚≠ê">‚≠ê</span>
                <span class="emoji" data-emoji="üí°">üí°</span>
                <span class="emoji" data-emoji="üëÄ">üëÄ</span>
                <span class="emoji" data-emoji="üöÄ">üöÄ</span>
                <span class="emoji" data-emoji="üíÄ">üíÄ</span>
                <span class="emoji" data-emoji="ü§°">ü§°</span>
                <span class="emoji" data-emoji="üëª">üëª</span>
                <span class="emoji" data-emoji="üéØ">üéØ</span>
                <span class="emoji" data-emoji="ü§∑">ü§∑</span>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>

    <!-- Settings modal -->
    <div id="settings-modal" class="modal hidden">
      <div class="modal-backdrop"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h2>Account Settings</h2>
          <p class="modal-description">Manage your identity and security settings.</p>
          <button id="close-settings" class="btn icon modal-close">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <div class="settings-group">
            <label class="settings-label">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
              </svg>
              Change Alias
            </label>
            <input type="text" id="settings-name" maxlength="20" placeholder="Anonymous" class="settings-input">
            <p class="settings-hint">This is how you appear to others.</p>
          </div>

          <div class="settings-group">
            <label class="settings-label">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="8" r="5"></circle>
                <path d="M20 21a8 8 0 1 0-16 0"></path>
              </svg>
              Avatar Image URL
            </label>
            <div class="avatar-preview-row">
              <div id="settings-avatar-preview" class="settings-avatar-preview">
                <span>?</span>
              </div>
              <input type="url" id="settings-avatar" placeholder="https://example.com/avatar.png" class="settings-input">
            </div>
            <p class="settings-hint">Direct link to your profile picture (PNG, JPG, or GIF).</p>
          </div>

          <div class="settings-group">
            <label class="settings-label">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"></path>
              </svg>
              Private Key
            </label>
            <div class="key-display">
              <span id="key-display-text">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</span>
              <button id="reveal-key-btn" class="btn small">Reveal</button>
            </div>
            <button id="export-key-btn" class="btn secondary full-width">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"></path>
              </svg>
              Export Private Key
            </button>
          </div>

          <div class="settings-group">
            <label class="settings-label">Your Public Key</label>
            <input type="text" id="pubkey-display" readonly class="settings-input mono">
          </div>
        </div>
        <div class="modal-footer">
          <button id="save-settings" class="btn primary">Save Changes</button>
        </div>
      </div>
    </div>
  </div>

  <script src="dashboard.js"></script>
</body>
</html>
